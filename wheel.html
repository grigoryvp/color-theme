<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/tinycolor/1.4.1/tinycolor.min.js"></script>
<script>
  const colorList = [];

  window.addEventListener('load', async () => {

    const img = document.getElementById('img');
    const res = await fetch(img.src);
    const data = await res.text();
    const question =
      '\\s*\\.([\\w-]+)\\s*' +
      '{[^}]*fill\\s*:\\s*([^};]+)\\s*;[^}]*}';
    const query = new RegExp(question, 'gm');

    let match = query.exec(data);
    while (match !== null) {
      const name = match[1];
      const val = match[2];
      colorList.push({name, val});
      match = query.exec(data);
    }
    onResize();
  });
  window.addEventListener('resize', onResize);
  function onResize() {
    const canvas = document.getElementById('wheel');
    const cx = cy = canvas.clientWidth;
    canvas.width = cx;
    canvas.height = cy;
    const ctx = canvas.getContext('2d');
    const imgData = ctx.createImageData(cx, cy);
    let pos = 0;
    for (let y = 0; y < cy; y ++) {
      for (let x = 0; x < cx; x ++) {
        const [dx, dy] = [(x - cx / 2) / cx * 2, (cy / 2 - y) / cy * 2];
        const r = Math.sqrt(dx * dx + dy * dy);
        if (r < 0.8) {
          let radians = Math.atan2(dy, dx);
          if (dy < 0) radians += Math.PI * 2;
          const angle = radians * 180 / Math.PI;
          const color = tinycolor({h: angle, s: 100, v: r / 0.8});
          imgData.data[pos ++] = color.toRgb().r;
          imgData.data[pos ++] = color.toRgb().g;
          imgData.data[pos ++] = color.toRgb().b;
          imgData.data[pos ++] = 255;
        }
        else {
          pos += 4;
        }
      }
    }

    ctx.putImageData(imgData, 0, 0);

    for (const colorInScheme of colorList) {
      const color = tinycolor(colorInScheme.val).toHsv();
      const dx = Math.cos(color.h / 180 * Math.PI) * color.v * 0.8;
      const dy = Math.sin(color.h / 180 * Math.PI) * color.v * 0.8;
      const x = cx / 2 * (1 + dx);
      const y = cy - cy / 2 * (1 + dy);
      ctx.beginPath();
      ctx.arc(x, y, 10, 0, 2 * Math.PI, false);
      ctx.fillStyle = tinycolor(colorInScheme.val).toHex8String();
      ctx.fill();
      ctx.strokeStyle = "#fff";
      ctx.stroke();
      ctx.fillStyle = "#fff";
      ctx.font = "12px Arial";
      const text = `${colorInScheme.name} ${Math.round(color.s * 100)}`;
      ctx.fillText(text, x + 15, y);
    }
  }
</script>
<style>
body { margin: 0; }
.container {
  display: grid;
  justify-content: center;
  grid-template-columns: 40vmax 40vmax;
}
#img {
  width: 100%;
  height: 100%;
}
#wheel {
  width: 100%;
  height: 100%;
}
</style>
</head>
<body>
  <div class="container">
    <img id="img" src="./color-scheme.svg"></img>
    <canvas id="wheel" width=100 height=100></canvas>
  </div>
</body>
</html>
